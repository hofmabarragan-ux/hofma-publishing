---
export const prerender = true;

import Layout from '../../layouts/Layout.astro';
import { getCollection, getEntry, render } from 'astro:content';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((entry) => ({
		params: { slug: entry.id },
	}));
}

const { slug } = Astro.params;
if (!slug) throw new Error('Missing slug');
const entry = await getEntry('blog', slug);
if (!entry) throw new Error(`Post not found: ${slug}`);
const { Content } = await render(entry);
const { title, description, pubDate, coverImage } = entry.data;
---

<Layout title={`${title} | Hofma Publishing`} description={description}>
	<article class="page-content">
		<div class="section-inner">
			<nav class="breadcrumb">
				<a href="/blog/">Blog</a>
				<span class="separator">/</span>
				<span>{title}</span>
			</nav>
			<time datetime={pubDate}>{new Date(pubDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
			<h1>{title}</h1>
			{coverImage && (
				<img src={coverImage} alt="" class="post-cover" />
			)}
			<div class="post-body">
				<Content />
			</div>
			<p><a href="/blog/" class="back-link">‚Üê Back to Blog</a></p>
		</div>
	</article>
</Layout>

<style>
	.page-content {
		padding: var(--space-2xl) var(--space-lg);
	}

	.section-inner {
		max-width: 720px;
		margin: 0 auto;
	}

	.breadcrumb {
		margin-bottom: var(--space-md);
		font-size: 0.875rem;
		color: var(--color-text-muted);
	}

	.breadcrumb .separator {
		margin: 0 var(--space-xs);
	}

	.page-content time {
		font-size: 0.875rem;
		color: var(--color-text-muted);
	}

	.page-content h1 {
		margin: var(--space-xs) 0 var(--space-xl);
	}

	.post-cover {
		width: 100%;
		margin-bottom: var(--space-xl);
		border-radius: 4px;
	}

	.post-body :global(p) {
		margin: 0 0 var(--space-md);
	}

	.back-link {
		font-weight: 500;
		margin-top: var(--space-xl);
		display: inline-block;
	}
</style>
